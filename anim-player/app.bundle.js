!function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=0)}([function(e,t,n){"use strict";function s(e,t){e.classList.toggle(t)}function o(e,t){e[t]=!e[t]}n.r(t);class r{constructor(e){this.props=e}static create(){const e=document.createElement("header"),t=document.createElement("div"),n=document.createElement("button"),s=document.createElement("button"),o=document.createElement("h1");return t.classList.add("wrapper"),n.classList.add("btn","btn_menu"),s.classList.add("btn","btn_options"),o.innerText="CodeJam - Animation Player",n.innerHTML='<div class="line line_1"></div><div class="line line_2"></div><div class="line line_3"></div>',s.innerHTML='<div class="dot dot_1"></div><div class="dot dot_2"></div><div class="dot dot_3"></div>',t.appendChild(n),t.appendChild(o),t.appendChild(s),e.appendChild(t),e}render(){const{props:e}=this,t=r.create();t.addEventListener("click",function(e){const{target:t}=e;t.closest(".btn_menu")&&(s(t.closest(".btn_menu"),"open"),o(this,"isMenuOpen")),t.closest(".btn_options")&&(s(t.closest(".btn_options"),"open"),o(this,"isOptionsOpen"))}.bind(e),!1),document.body.appendChild(t)}}function a(e,t,n){var s;e[n]||(function(e){const t=e;Object.keys(t).forEach(e=>{t[e]=!1})}(e),function(){const e=document.querySelector(".tool.active");e&&e.classList.remove("active")}()),s="active",t.classList.toggle(s),function(e,t){e[t]=!e[t]}(e,n)}class c{constructor(e){this.props=e}static create(){const e=document.createElement("div"),t=document.createElement("button"),n=document.createElement("button"),s=document.createElement("button"),o=document.createElement("button"),r=document.createElement("hr");return e.classList.add("tools"),t.classList.add("tool","tool_paint-bucket"),n.classList.add("tool","tool_color-picker"),s.classList.add("tool","tool_move"),o.classList.add("tool","tool_transform"),e.appendChild(t),e.appendChild(n),e.appendChild(r),e.appendChild(s),e.appendChild(o),e}render(){const{props:e}=this,t=c.create();t.addEventListener("click",function(e){const{target:t}=e;t.closest(".tool_paint-bucket")&&a(this.selectedTools,t.closest(".tool_paint-bucket"),"bucket"),t.closest(".tool_color-picker")&&a(this.selectedTools,t.closest(".tool_color-picker"),"colorPicker"),t.closest(".tool_move")&&a(this.selectedTools,t.closest(".tool_move"),"move"),t.closest(".tool_transform")&&a(this.selectedTools,t.closest(".tool_transform"),"transform")}.bind(e),!1),document.body.appendChild(t)}}class i{constructor(e){this.props=e}static create(e){const t=document.createElement("li"),n=document.createElement("div"),s=document.createElement("button"),o=document.createElement("button"),r=document.createElement("div"),a=document.createElement("div"),c=document.createElement("canvas");return c.setAttribute("width","32"),c.setAttribute("height","32"),n.innerHTML=`<span>${e}</span>`,t.setAttribute("data-number",e),t.classList.add("frame"),n.classList.add("frame__number"),s.classList.add("frame__remove"),o.classList.add("frame__copy"),r.classList.add("frame__move"),a.classList.add("frame__canvas"),a.appendChild(c),t.appendChild(n),t.appendChild(s),t.appendChild(o),t.appendChild(r),t.appendChild(a),t}render(){const{countFrames:e}=this.props,t=i.create(e+1),n=document.querySelector(".btn_new-frame");document.querySelector(".frames").insertBefore(t,n)}}function d(e,t){const n=t,s=+e.value;var o;n.selectedFPS=s,o=s,document.querySelector(".preview__fps-view").innerText=`FPS: ${o}`}function l(e){const t=e;if(function(){for(;window.intAnimPrev>0;)window.clearTimeout(window.intAnimPrev),window.intAnimPrev-=1}(),0===t.animationFrames.length)return void document.querySelector(".preview__animation").style.setProperty("background-image",'url("")');const n=t.animationFrames[t.frameOnPreview];var s;s=n,document.querySelector(".preview__animation").style.setProperty("background-image",`url("${s}")`),!function(e){return e.frameOnPreview+1>e.animationFrames.length-1}(t)?t.frameOnPreview+=1:t.frameOnPreview=0;const o=1e3/t.selectedFPS;window.intAnimPrev=setTimeout(l,o,t)}function u(e){const{target:t}=e,n=this;switch(e.type){case"input":d(t.closest(".preview__fps-control"),n);break;case"click":t.closest(".preview__fullscreen")&&function(){const e=document.querySelector(".preview__animation");e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}()}}class m{constructor(e){this.props=e}static create(e){const t=e.selectedFPS,n=document.createElement("div"),s=document.createElement("div"),o=document.createElement("input"),r=document.createElement("span"),a=document.createElement("div"),c=document.createElement("button");return r.innerText=`FPS: ${t}`,o.setAttribute("type","range"),o.setAttribute("min","1"),o.setAttribute("max","24"),o.setAttribute("step","1"),o.value=t,n.classList.add("preview"),s.classList.add("preview__settings"),o.classList.add("preview__fps-control"),r.classList.add("preview__fps-view"),a.classList.add("preview__animation"),c.classList.add("preview__fullscreen"),s.appendChild(r),s.appendChild(o),n.appendChild(c),n.appendChild(a),n.appendChild(s),n}static createAnimationFrames(e,t="rebuild"){const n=e,s=[],o=document.querySelectorAll(".canvas-list li"),r=document.querySelector(".canvas-list li.active");if(!r)return void(n.animationFrames.length=0);const a=r.firstChild;"add"===t?n.animationFrames.push(a.toDataURL()):"rebuild"===t&&(o.forEach(e=>{const t=e.firstChild;s.push(t.toDataURL())}),function(e){e.animationFrames.length=0}(e),n.animationFrames=s)}static startAnimationPreview(e){const t=1e3/e.selectedFPS;window.intAnimPrev=setTimeout(l,t,e)}render(){const{props:e}=this,t=m.create(e);t.addEventListener("input",u.bind(e)),t.addEventListener("click",u.bind(e)),document.body.appendChild(t)}}function p(e){document.querySelector(".frame.active").querySelector("canvas").getContext("2d").putImageData(e,0,0)}function v(e){const t=e.target,n=t.getContext("2d"),s={x:0,y:0,scale:0},o=t.getAttribute("width"),r=t.offsetWidth;s.scale=r/o,s.x=e.offsetX/s.scale,s.y=e.offsetY/s.scale,n.fillRect(Math.ceil(s.x)-1,Math.ceil(s.y)-1,1,1),n.fill()}function f(e){const t=e.target,n=this;switch(e.type){case"mousedown":n.canvasState.isDraw=!0,t.addEventListener("mousemove",v);break;case"mousemove":break;case"mouseleave":case"mouseup":n.canvasState.isDraw=!1,t.removeEventListener("mousemove",v),p(t.getContext("2d").getImageData(0,0,32,32)),m.createAnimationFrames(n),m.startAnimationPreview(n),window.getSelection&&(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges());break}}class b{constructor(e){this.props=e}static create(e){const t=document.createElement("canvas"),n=document.createElement("li");return n.classList.add("canvas-list__item"),t.setAttribute("width","32"),t.setAttribute("height","32"),n.setAttribute("data-canvas-number",e),n.appendChild(t),n}static renderCanvasWrapper(){const e=document.createElement("ul");e.classList.add("canvas-list"),document.body.appendChild(e)}static copyCanvas(e,t,n){const s=e.getContext("2d").getImageData(0,0,32,32);t.getContext("2d").putImageData(s,0,0),t.addEventListener("mousedown",f.bind(n),!1),t.addEventListener("mousemove",f.bind(n),!1),t.addEventListener("mouseup",f.bind(n),!1),t.addEventListener("mouseleave",f.bind(n),!1),p(s)}render(){const{props:e}=this,t=b.create(e.countFrames),n=t.firstChild;n.addEventListener("mousedown",f.bind(e),!1),n.addEventListener("mousemove",f.bind(e),!1),n.addEventListener("mouseup",f.bind(e),!1),n.addEventListener("mouseleave",f.bind(e),!1),document.querySelector(".canvas-list").appendChild(t)}}function h(e){return 0===e}function _(){document.querySelectorAll(".frame")&&document.querySelectorAll(".frame").forEach((e,t)=>{e.querySelector(".frame__number span").innerText=t+1,e.setAttribute("data-number",t+1)})}function w(){document.querySelectorAll(".canvas-list__item")&&document.querySelectorAll(".canvas-list__item").forEach((e,t)=>{e.setAttribute("data-canvas-number",t+1)})}function y(e,t){const n=t;"add"===e&&(n.countFrames+=1),"remove"===e&&(h(n.countFrames)?n.countFrames=0:n.countFrames-=1)}function g(e,t){document.querySelector(t).removeChild(e)}function S(e,t){const n=e.cloneNode(!0),s=e.nextSibling;document.querySelector(t).insertBefore(n,s)}function L(e){const t=document.querySelector(`${e}.active`);t&&t.classList.remove("active")}function E(e,t){const n=+e.getAttribute("data-number");L(".frame"),e.classList.add("active"),function(e,t){t.currentFrame=e}(n,t)}function C(e,t){!function(e){new i(e).render()}(t),y("add",t),E(e.previousSibling,t)}function F(){const e=document.querySelector(".frame.active");if(!e)return;const t=e.getAttribute("data-number"),n=document.querySelector(`[data-canvas-number='${t}']`);L(".canvas-list__item"),n.classList.add("active")}function A(e){const{target:t}=e,n=this;return t.closest(".btn_new-frame")&&(C(t.closest(".btn_new-frame"),n),new b(n).render(),F(),m.createAnimationFrames(n,"add")),t.closest(".frame__remove")?(function(e,t){const n=t,s=e.previousSibling,o=e.nextSibling;if(g(e,".frames"),y("remove",n),_(),e.classList.contains("active")){const e=s||o;e&&!h(n.countFrames)&&E(e,n)}else E(document.querySelector(".frame.active"),n);h(n.countFrames)&&(n.currentFrame=null)}(t.closest(".frame"),n),function(e){const t=e.getAttribute("data-number");g(document.querySelector(`[data-canvas-number='${t}']`),".canvas-list"),w()}(t.closest(".frame")),F(),void m.createAnimationFrames(n)):t.closest(".frame__copy")?(function(e,t){S(e,".frames"),y("add",t),_(),E(e.nextSibling,t)}(t.closest(".frame"),n),function(e,t){const n=e.getAttribute("data-number"),s=document.querySelector(`[data-canvas-number='${n}']`),o=document.querySelector(`[data-canvas-number='${n}']`).firstChild;S(s,".canvas-list");const r=document.querySelectorAll(`[data-canvas-number='${n}']`)[1].firstChild;b.copyCanvas(o,r,t),w()}(t.closest(".frame"),n),F(),void m.createAnimationFrames(n)):void(t.closest(".frame")&&(E(t.closest(".frame"),n),F()))}class q{constructor(e){this.props=e}static create(){const e=document.createElement("ul"),t=document.createElement("button");return e.classList.add("frames"),t.classList.add("btn_new-frame"),t.innerHTML='<div class="icon"></div><span>Add new frame</span>',e.appendChild(t),e}render(){const{props:e}=this,t=q.create();t.addEventListener("click",A.bind(e),!1),document.body.appendChild(t)}}n(1);const P=new class{constructor(){this.selectedTools={bucket:!1,colorPicker:!1,move:!1,transform:!1},this.canvasState={isDraw:!1},this.isMenuOpen=!1,this.isOptionsOpen=!1,this.animationFrames=[],this.currentFrame=null,this.countFrames=0,this.selectedFPS=4,this.frameOnPreview=0}render(){const e=new r(this),t=new c(this),n=new q(this),s=new m(this);e.render(),t.render(),n.render(),b.renderCanvasWrapper(),s.render()}};window.player=P,P.render()},function(e,t){}]);
//# sourceMappingURL=app.bundle.js.map